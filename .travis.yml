language: php
sudo: false
dist: trusty

cache:
  directories:
    - vendor
    - $HOME/.composer/cache

env:
  global:
    - COMPOSER_SANDBOX_TMPDIR="$HOME/.tmp"
    - COMPOSER_SANDBOX_EXTRA_ARGS="-vv"
    - IGNORE_PLATFORM_REQS=""
  jobs:
    - COMPOSER_VERSION="1"
    - COMPOSER_VERSION="2"

php:
  - 5.6
  - 7.0
  - 7.4

jobs:
  include:
    # Test PHP 8.0+ only with composer v2 while ignoring platform reqs 
    # so conflicting dependencies like Symfony polyfills are not installed.
    - php: 8.0
      env: COMPOSER_VERSION="2" IGNORE_PLATFORM_REQS="--ignore-platform-reqs"
    - php: nightly
      env: COMPOSER_VERSION="2" IGNORE_PLATFORM_REQS="--ignore-platform-reqs"

matrix:
  allow_failures:
    - php: nightly
    - php: 8.0

install: travis_retry bin/install-project

script: bin/tests-run
  
